---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# dendroTools

The core purpose of the dendroTools package is to introduce novel dendroclimatological methods to study linear and nonlinear relationships between climate data and tree-ring sequences. There are two core functions. The first core function is daily_response(), which finds the optimal sequence of days that are linearly or nonlinearly related to a tree-ring proxy records. The second core function is compare_methods() which calculates several performance measures for train and test data for different regression methods.

To use daily_response(), two data frames are required, one with daily climate data, e.g. mean daily temperature; and one with tree-ring proxy records. Example data is provided, so users can see, how data frames should be organized. The daily_response() calculates all possible values of a selected statistical measure between response variable(s) and daily environmental data. Calculations are based on a moving window, which runs through daily environmental data and calculates moving averages. 

compare_methods() calcualtes performance measures for multiple linear regression (MLR), artificial neural networks with Bayesian regularization training algorithm (ANN), M5P model trees (MT), model trees with bagging (BMT) and random forest of regression trees (RF). Calculated performance measures are correlation coefficient (r), root mean squared error (RMSE), root relative squared error (RSSE), index of agreement (d), reduction of error (RE), coefficient of efficiency (CE) nad mean bias.

## Installation

You can install dendroTools using:

```{r gh-installation, eval = FALSE}
# install.packages("devtools")
devtools::install_github("jernejjevsenak/dendroTools") # current version under development

install.packages("devtools") # from CRAN
```

## Examples

This is a basic example which demonstrates how to use the daily_response(): 

```{r example 1, results = 'hide'}
## basic example code
library(dendroTools)
data(LJ_daily_temperatures) 
data(example_proxies_1)
result1 <- daily_response(response = example_proxies_1, env_data = LJ_daily_temperatures, 
							method = "lm", measure = "r.squared", lower_limit = 30, upper_limit = 270, remove_insignificant = TRUE, row_names_subset = TRUE)

```
This function is computationally intensive and it takes a while to calculate all possible values. Especially, if nonlinear "brnn" method is used. While calculating, progress bar shows the percentage of calculated values. 

The return of this function is a list with four elements: @calculations, @method, @measure and @optimized_result. The return is organized in a way, that can be used by three plotting functions: plot_extreme(), plot_specific() and plot_heatmap(). 
Function plot_extreme() graphs a line plot of a row with the highest calculated measure. It indicates the sequence of days, that give the best value of selected statistical measure. With plot_specific(), measures with selected window width are plotted. Function plot_heatmap() is a visual representation of calculated values.

```{r plot examples}
plot_extreme(result1, title = TRUE)
plot_specific(result1, window_width = 100, title = TRUE)
plot_heatmap(result1)
```

Here is an example of using the compare_methods(). The core idea is to compare different regression methods and select the best model for climate reconstruction. Users should spend some time to understand what are the tunning parameters of specific method. To boost the performance of regression methods, set the parameter use_caret = TRUE, to optimize some parameters automatically.  

```{r example 2, results = 'hide'}
library(dendroTools)
data(example_dataset_1)
experiment_1 <- compare_methods(formula = MVA ~ ., dataset = example_dataset_1, k = 3, repeats = 100, 
                                use_caret = TRUE)
```

To see the outputs, use the following code.

```{r visualise element 1}
experiment_1[[1]] # See a data frame results of mean and standard deviation for different methods
```

```{r visualise element 2}
experiment_1[[2]] # See a data frame results of average rank and share of rank 1 for different methods
```

```{r visualise element 3}
experiment_1[[3]] # See a ggplot of mean bias for calibration data
```

```{r visualise element 4}
experiment_1[[4]] # See a ggplot of mean bias for validation data
```

```{r visualise element 5}
experiment_1[[5]] # See a data frame with the parameter values used by regression methods
```

## Authors
* **Jernej Jevšenak**

## Collaborators
* **Prof. dr. Tom Levanič**
